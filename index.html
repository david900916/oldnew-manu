<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>å‡ºèœé€²åº¦çœ‹æ¿â€”è¨ºæ–·ç‰ˆ</title>
</head>
<body>
  <h1>ğŸ”” å‡ºèœé€²åº¦ï¼ˆè¨ºæ–·ï¼‰</h1>
  <div id="progress">è¼‰å…¥ä¸­â€¦</div>

  <script>
    const API = 'https://script.google.com/macros/s/AKfycbzmJwlIL0fh-XbbD1QTa4CcJdjhOwXLFYO1NxV00F2FAfqdyqGf4XxPi6Car2dt-kkguw/exec';

    function handle(data) {
      console.log('âœ… JSONP callback data:', data);
      const idx = data.currentIndex;
      const it  = data.items[idx] || { name: 'â€”', eta: 0 };
      const elapsed = Math.floor((Date.now() - new Date(data.startTime)) / 60000);
      document.getElementById('progress').innerHTML =
        `ç¬¬ ${idx+1} é“ï¼š${it.name} ï¼ˆå·²ç”¨ ${elapsed} åˆ†é˜ï¼Œé ä¼° ${it.eta} åˆ†é˜ï¼‰`;
    }

    function fetchProgress() {
      // å»ºç«‹ script å…ƒç´ 
      const s = document.createElement('script');
      // åœ¨ append å‰ç¶å®š onload/onerror
      s.onload  = () => console.log('âœ… JSONP script è¼‰å…¥æˆåŠŸ');
      s.onerror = () => console.error('âŒ JSONP script è¼‰å…¥å¤±æ•—');
      // è¨­å®š src
      s.src = `${API}?action=status&callback=handle&ts=${Date.now()}`;
      // æœ€å¾Œ append
      document.body.appendChild(s);
    }

    // é é¢è¼‰å…¥èˆ‡æ¯åˆ†é˜éƒ½è·‘ä¸€æ¬¡
    window.addEventListener('load', fetchProgress);
    setInterval(fetchProgress, 60_000);
  </script>
</body>
</html>
